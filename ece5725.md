# ECE 5725 Fall 2020 Lecture Notes

## Lecture 1, 9/2
1. Lutron Linux microcontrollers in light switches

## Lecture 2, 9/4
1. SpaceX Linux microcontrollers, 3 to make sure others take over if the first one fails, they check on each other by comparing outputs of simple commands
2. 

## Lecture 3, 9/7

## Lecture 4, 9/9

## Lecture 5, 9/11

## Lecture 6, 9/14

## Lecture 7, 9/16
1.
2.
3.

## Lecture 8, 9/18
1. VNC viewer might throw an error when you type `startx`. Solution is to change to "boot to desktop" 
2. Don't do `sudo startx`, it could mess up the Linux files
3. FIFO, Sockets, pipe

## Lecture 8, 9/21
1. FIFO is a named pipe. Usual pipe `|` is temporary, never stored
2. P1 P2 2 processes `P1 > fifo`. P2 can read the fifo.
3. `su - jfs9`: `-` means restore it to how it was
4. `whoami` to find out what your user id is
5. `subprocess.check_output('cmd_string', shell=True)` in Python to run a command
6.  GPIO pins (make sure white line aligns with piTFT buttons)
7. Older RPi modules had 26 pins, new ones have 40 pins
8. Green pins: typically no secondary functions
9. GREEN = Serial Rx+Tx, or UART (Universally Asynchronous Rx and Tx)
10. LIGHT BLUE = i2C, SDA and SCL, camera
11. PURPLE = SPI, SPI1 used by piTFT
12. BLACK = Ground
13. 6 SPI channels
14. SPI channels overlap with i2C channels, can't use 6 SPI and 6 i2C
15. 3.3 V on each RPi, 16 mA max from any output, don't power other devices through RPi, it can't provide too much current
16. ``` 
import RPi.GPIO as GPIO
GPIO.setmode(GPIO.BCM) #set up for broadcom numbering not board numbering
GPIO.setup(26, GPIO.IN, pull_up_down=GPIO.PUD_UP)
while True:
	....
```

See diagrams
## Lecture 8, 9/23
1. Debug mplayer fifo with simple commands like `echo "PAUSE" > video_fifo`
2. Creating video_fifo is necessary: otherwise if you write "quit" in your fifo, mplayer will read it, quit and never start again
3. In start_video.py, if you write 
```
video_control.py &
mplayer &
```
then you are missing something (?)
4. Use a current limiting resistor (1k resistor) when using GPIO as input, b/c if someone sets it up as output then you are not sending too much current..
5. This resistor available internally in the Pi too (value 50 k)
6. Internal resistor dangerous in production setting: someone could reset your GPIO.setup
7. Use pull up when xx and pull down when xxx
![](ECE5725/internet2.png)
![](ECE5725/internet.png)
![](ECE5725/internet3.png)

1. `-framedrop` tells mplayer to drop frames if they don't come right
2. Multiple button hits if time delay close to 0, if multiple python guys running in the background, if funny mechanical/electrical stuff in the piTFT button
3. User Datagram Protocol and Network Time Protocol to communicate to an atomic clock and get the time up to a few ms
4. Pi got rid of ntp daemon a couple of cycles ago, replaced it with timesyncd (a little less flexible), does the same thing. Timesyncd daemon exists in the Pi, takes care of time sync.
5. SDL: simple direct media layer
6. pygame interface better than SDL: but need to do some Linux kernel surgery
7. 	Need to downgrade to Wheezy from Buster (~4 iterations down) to make pygame work 
8. RECT is the bounding box for an object you draw in pygame, SURFACE is the canvas
9. `os.putenv('SDL_VIDEODRIVER','fbcon')`, `os.putenv('SDL_FBDEV','/dev/fb1')` before `pygame.init()`
10. `blit` in pygame combines 2 surfaces, `flip` sends surface stuff to the (piTFT) screen 


## Lab 1 + HW 1

1. Format SD card to FAT32
2. Use `balenaEtcher` to etch Raspbian Buster on to SD card
3. Create file `ssh` with one space and a file 
3. Create backup via Win32 Disk Imager (as and when needed)
4. Insert SD card into the Pi, hook up to power, ehternet cable connection to laptop (easiest, but could also remotely connect to Pi)
5. raspi-config to change hostname, locale, etc.
6. `sudo apt-get update` and `sudo apt-get full-upgrade`
7. If Wifi not working, use `wpa_supplicant.conf`
8. Install piTFT by using scripts, change `/boot/config.txt`, some other files need to be changed too
9. To run the bunny video, type `sudo SDL_VIDEODRIVER=fbcon SDL_FBDEV=/dev/fb0 mplayer -vo sdl -framedrop bigbuckbunny320p.mp4`. 
10. Mplayer controls:
```
 <-  or  ->       seek backward/forward 10 seconds
 down or up       seek backward/forward  1 minute
 pgdown or pgup   seek backward/forward 10 minutes
 < or >           step backward/forward in playlist
 p or SPACE       pause movie (press any key to continue)
 q or ESC         stop playing and quit program
 + or -           adjust audio delay by +/- 0.1 second
 o                cycle OSD mode:  none / seekbar / seekbar + timer
 * or /           increase or decrease PCM volume
 x or z           adjust subtitle delay by +/- 0.1 second
 r or t           adjust subtitle position up/down, also see -vf expand
```
11. Choose 4 out of these commands to create your `control panel`.
12. To fast forward or rewind, use commands such as `seek + (or -) 10` to echo into the fifo
13. Change screen resolutions and raspi-config `boot to desktop option` to make VNC working
14. 